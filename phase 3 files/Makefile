#-------digicode--------------------------------------------#

all: digicodea.vbe \
     digicodej.vbe \
     digicodem.vbe \
     digicodeo.vbe \
     digicoder.vbe \
     digicode_boom \
     digicode_boog \
     digicode_loon 
	     @echo "<-- Generated"

all_vbe: digicodea.vbe \
		 digicodej.vbe \
     	 digicodem.vbe \
     	 digicodeo.vbe \
		 digicoder.vbe 
		 	@echo "<-- Generated"

#-------Finite State Machine Synthesis-----------------#

vhd_to_fsm:
	rename .vhd .fsm *.vhd

digicodea.vbe: digicode.fsm
	@echo "    Encoding Synthesis -> digicodea.vbe"
	syf -CEV -a digicode

digicodej.vbe: digicode.fsm
	@echo "    Encoding Synthesis  -> digicodej.vbe"
	syf -CEV -j digicode

digicodem.vbe: digicode.fsm
	@echo "    Encoding Synthesis  -> digicodem.vbe"
	syf -CEV -m digicode

digicodeo.vbe: digicode.fsm
	@echo "    Encoding Synthesis  -> digicodeo.vbe"
	syf -CEV -o digicode

digicoder.vbe: digicode.fsm
	@echo "    Encoding Synthesis  -> digicoder.vbe"
	syf -CEV -r digicode

#-------BOOM    ---------------------------------------#

digicode_boom : digicodea_b.vbe digicodej_b.vbe digicodem_b.vbe \
			digicodeo_b.vbe digicoder_b.vbe
%_b.vbe : %.vbe
	@echo "	   Boolean Optimization -> $@ "
	boom -V -d 50 $* $*_b > $*_boom.out

#-------BOOG    ---------------------------------------#


digicode_boog : digicodea_b.vst digicodej_b.vst digicodem_b.vst \
			digicodeo_b.vst digicoder_b.vst
%.vst : %.vbe laxfile.lax
	@echo "	   Binding and optimizing on Gates -> $@ "
	boog $* $* -l laxfile > $*_boog.out


#-------LOON    ---------------------------------------#


digicode_loon : digicodea_b_l.vst digicodej_b_l.vst digicodem_b_l.vst \
			digicodeo_b_l.vst digicoder_b_l.vst
%_l.vst : %.vst laxfile.lax
	@echo "	Netlist Optimization -> $@ "
	loon $* $*_l -l laxfile > $*_loon.out


#-------PROOF   ---------------------------------------#



%_b_l_net.vbe : %_b_l.vst %.vbe
	@echo " Formal checking -> $@ "
	flatbeh $*_b_l $*_b_l_net > $*_flatbeh.log
	proof -d $* $*_b_l_net > $*_proof.log

#-------SCAN   ---------------------------------------#
ac_scapin_registers: 
	cat digicodea_b_l.vst | grep sff

%_scan.vst : %.vst scan.path
	@echo " scan-path insertion -> $@ "
	scapin -VRB $* scan $*_scan > scapin.out

#-------OCP   ---------------------------------------#

ocp : digicode_p.ap
digicode_p.ap : digicode.ioc digicodea_b_l_scan.vst
	MBK_IN_LO=vst; export MBK_IN_LO;\
	MBK_OUT_PH=ap; export MBK_OUT_PH;\
	ocp -v -ring -ioc digicode digicodea_b_l_scan digicode_p > ocp.out

#-------NERO   ---------------------------------------#

nero : digicodea_b_l_scan.ap
digicodea_b_l_scan.ap: digicode_p.ap digicodea_b_l_scan.vst
	nero -V -p digicode_p digicodea_b_l_scan digicodea_b_l_scan > nero.out

#------COUGAR-LVX   ---------------------------------------#

%.al : %.ap
	MBK_OUT_LO=al; export MBK_OUT_LO; \
	export RDS_TECHNO_NAME=./techno/techno-035.rds; \
	cougar -v $* > cougar_$*.out
	lvx vst al $* $* -f > lvx_$*.out

#------DRUC   ---------------------------------------#

druc_core : digicodea_b_l_scan.ap
	export RDS_TECHNO_NAME=./techno/techno-symb.rds; \
	druc digicodea_b_l_scan > druc_core.out

#------S2r   ---------------------------------------#
digicode_chip.cif : digicodea_b_l_scan.ap
	export RDS_TECHNO_NAME=./techno/techno-035.rds; \
	export RDS_OUT=cif; \
	s2r -v -r digicodea_b_l_scan > s2r.out

#-------Clean Up---------------------------------------#

clean :
	rm -f  *.vbe *.enc *.vst *.out *.xsc *0.lax *~
	@echo "Erase all the files generated by the makefile"

